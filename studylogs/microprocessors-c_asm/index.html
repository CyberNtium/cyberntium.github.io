<!DOCTYPE html>
<html lang="en">

<head>
  <title>
  Microprocessors - C in ASM · cyberntium
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="Carl Ho">
<meta name="description" content="
  C and Assembly
  
    
    Link to heading
  

According to the lecture slides, it is apparently pretty common in embedded applications.

  Embedded Applications
  
    
    Link to heading
  

These are programs that are designed to run on very small computer systems. For example, think of the microcontrollers in your smart fridge, raspberry pi or literally anything that has a microcontroller inside. Since these systems have very limited resources in terms of memory and CPU, efficiency is very critical. That&rsquo;s why ASM and C are being used together as they are VERY low level as far as programming languages go.">
<meta name="keywords" content="blog,developer,personal">



  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Microprocessors - C in ASM">
  <meta name="twitter:description" content="C and AssemblyLink to headingAccording to the lecture slides, it is apparently pretty common in embedded applications.
Embedded ApplicationsLink to headingThese are programs that are designed to run on very small computer systems. For example, think of the microcontrollers in your smart fridge, raspberry pi or literally anything that has a microcontroller inside. Since these systems have very limited resources in terms of memory and CPU, efficiency is very critical. That’s why ASM and C are being used together as they are VERY low level as far as programming languages go.">

<meta property="og:url" content="https://cyberntium.github.io/studylogs/microprocessors-c_asm/">
  <meta property="og:site_name" content="cyberntium">
  <meta property="og:title" content="Microprocessors - C in ASM">
  <meta property="og:description" content="C and AssemblyLink to headingAccording to the lecture slides, it is apparently pretty common in embedded applications.
Embedded ApplicationsLink to headingThese are programs that are designed to run on very small computer systems. For example, think of the microcontrollers in your smart fridge, raspberry pi or literally anything that has a microcontroller inside. Since these systems have very limited resources in terms of memory and CPU, efficiency is very critical. That’s why ASM and C are being used together as they are VERY low level as far as programming languages go.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="studylogs">
    <meta property="article:published_time" content="2025-11-17T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-11-17T00:00:00+00:00">




<link rel="canonical" href="https://cyberntium.github.io/studylogs/microprocessors-c_asm/">


<link rel="preload" href="/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/css/coder.min.ebdf1a5dca6a69142e979b32668c69f2a95448b145a168104c5808b14d2b75b0.css" integrity="sha256-698aXcpqaRQul5syZoxp8qlUSLFFoWgQTFgIsU0rdbA=" crossorigin="anonymous" media="screen" />






  
    
    
    <link rel="stylesheet" href="/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css" integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin="anonymous" media="screen" />
  



 




<link rel="icon" type="image/svg+xml" href="/img/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="/img/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/img/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">









</head>






<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="https://cyberntium.github.io/">
      cyberntium
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="/blog/">Blog</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/about">About</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/projects/">Projects</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/studylogs/">Study Log</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/music/">Music</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container page">
  <article>
    <header>
      <h1 class="title">
        <a class="title-link" href="https://cyberntium.github.io/studylogs/microprocessors-c_asm/">
          Microprocessors - C in ASM
        </a>
      </h1>
    </header>

    <h1 id="c-and-assembly">
  C and Assembly
  <a class="heading-link" href="#c-and-assembly">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h1>
<p>According to the lecture slides, it is apparently pretty common in embedded applications.</p>
<h2 id="embedded-applications">
  Embedded Applications
  <a class="heading-link" href="#embedded-applications">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>These are programs that are designed to run on very small computer systems. For example, think of the microcontrollers in your smart fridge, raspberry pi or literally anything that has a microcontroller inside. Since these systems have very limited resources in terms of memory and CPU, efficiency is very critical. That&rsquo;s why ASM and C are being used together as they are VERY low level as far as programming languages go.</p>
<h1 id="methods-of-integrating-c-with-asm">
  Methods of Integrating C with ASM
  <a class="heading-link" href="#methods-of-integrating-c-with-asm">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h1>
<ul>
<li>Inline Assembly - These are small, assembly codes written directly inside a C function. You know its an Assembly code when there is a special keyword in front like (__asm)</li>
<li>Embedded Assembly - These are full subroutines written in Assembly, but called from C. Essentially, the ASM code is written in a separate file which can be called from another separate C file. It is tidier since these are separate files.</li>
</ul>
<hr>
<h1 id="c-programming-in-arm">
  C Programming in ARM
  <a class="heading-link" href="#c-programming-in-arm">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h1>
<p><em>This part is kinda not very important (in my opinion) and even I don&rsquo;t fully understand it, feel free to skip to the inline vs embedded part if you want to</em>
Before we even do anything, there are some prerequisites. We must have these 4 code files:</p>
<ul>
<li>Startup.s</li>
<li>Retarget.c</li>
<li>Serial.c</li>
<li>Init_serial.c
I will just briefly go through each one:</li>
</ul>
<h3 id="startups">
  Startup.s
  <a class="heading-link" href="#startups">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p><figure class="center"><img src="https://i.imgur.com/Si9RuHO.png"
    alt="startup.s">
</figure>

<figure class="center"><img src="https://i.imgur.com/9Z9XwCm.png"
    alt="startup.s">
</figure>
</p>
<ul>
<li>Essentially, Startup.s do some stuff including:</li>
<li>
<ul>
<li>Setting the stack pointer (SP)</li>
</ul>
</li>
<li>
<ul>
<li>Define the exception vector table</li>
</ul>
</li>
<li>
<ul>
<li>Places the CPU in the correct mode</li>
</ul>
</li>
<li>
<ul>
<li>Calls the C library init</li>
</ul>
</li>
<li>
<ul>
<li>Runs <code>main()</code>
But why all of these?</li>
</ul>
</li>
<li>Because on a microcontroller, there is no Operating System (OS). So you literally must manually boot the C runtime using this script.</li>
</ul>
<h3 id="retargetc---connects-printf-to-uart">
  Retarget.c -&gt; Connects printf() to UART
  <a class="heading-link" href="#retargetc---connects-printf-to-uart">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<figure class="center"><img src="https://i.imgur.com/ohSaEnU.png"
    alt="startup.s">
</figure>

<ul>
<li>Apparently this script just allows <code>printf()</code> to print to Keil&rsquo;s UART window</li>
</ul>
<h3 id="serialc---uart-driver-implementation">
  Serial.c -&gt; UART Driver Implementation
  <a class="heading-link" href="#serialc---uart-driver-implementation">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<figure class="center"><img src="https://i.imgur.com/Huz2a5s.png"
    alt="startup.s">
</figure>

<ul>
<li>Implements the UART function used in Retarget.c</li>
</ul>
<h3 id="init_serialc---sets-up-uart-configuration">
  Init_serial.c -&gt; Sets up UART Configuration
  <a class="heading-link" href="#init_serialc---sets-up-uart-configuration">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<figure class="center"><img src="https://i.imgur.com/aoqUFfb.png"
    alt="startup.s">
</figure>

<ul>
<li>Initialises the UART hardware before using</li>
</ul>
<h4 id="summary-of-all-the-gibberish-above">
  Summary of All the Gibberish Above
  <a class="heading-link" href="#summary-of-all-the-gibberish-above">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h4>
<table>
  <thead>
      <tr>
          <th>File</th>
          <th>Why it&rsquo;s needed</th>
          <th>What it does</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>Startup.s</strong></td>
          <td>To start any C program on ARM</td>
          <td>Sets SP, vectors, enters main()</td>
      </tr>
      <tr>
          <td><strong>Retarget.c</strong></td>
          <td>To use printf</td>
          <td>Redirects I/O to UART</td>
      </tr>
      <tr>
          <td><strong>Serial.c</strong></td>
          <td>To physically send characters</td>
          <td>Low-level UART TX driver</td>
      </tr>
      <tr>
          <td><strong>Init_serial.c</strong></td>
          <td>To enable UART hardware</td>
          <td>Configures UART registers</td>
      </tr>
  </tbody>
</table>
<p>Alright, finally, bullshit is done. Time for some actual ASM shit</p>
<hr>
<h1 id="inline-assembly">
  Inline Assembly
  <a class="heading-link" href="#inline-assembly">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h1>
<p>Inline assembly as the name suggests, means inserting ARM assembly codes directly into C codes.<br>
For example, <code>__asm(&quot;ADD r1, r0, #1&quot;);</code> can be written inside a C code instead of a separate .s file.</p>
<h2 id="inline-assembly-syntax">
  Inline Assembly Syntax
  <a class="heading-link" href="#inline-assembly-syntax">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<h3 id="single-line-format">
  Single-line Format
  <a class="heading-link" href="#single-line-format">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span><span style="color:#ff7b72">__asm</span>(<span style="color:#a5d6ff">&#34;ADD r1, r0, #1&#34;</span>);
</span></span></code></pre></div><p>Problem with using this format is that:</p>
<ul>
<li>We cannot include comments</li>
<li>Must be in a single continuous string</li>
<li>Use ; to separate multiple instructions in a single line</li>
</ul>
<p>More examples:</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span><span style="color:#ff7b72">__asm</span>(<span style="color:#a5d6ff">&#34;MOV r2, r1; ADD r3, r2, #4&#34;</span>);
</span></span></code></pre></div><p>As we can see, there&rsquo;s two ASM instruction there, <code>MOV r2, r1</code> and <code>ADD r3, r2, #4</code> separated by ;</p>
<h3 id="multi-line-format">
  Multi-line Format
  <a class="heading-link" href="#multi-line-format">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>More flexible than single-line, uses curly-brackets:</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span><span style="color:#ff7b72">__asm</span> {
</span></span><span style="display:flex;"><span>    MOV r0, r1  ; comments allowed yay
</span></span><span style="display:flex;"><span>    ADD r2, r0, r3
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>As we can see, it is:</p>
<ul>
<li>Easier to read</li>
<li>Can write comments</li>
<li>Actually mimicks the ASM code writing style</li>
</ul>
<h2 id="some-restrictions">
  Some Restrictions
  <a class="heading-link" href="#some-restrictions">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>These are summarised using ChatGPT (im sorry~)
<figure class="center"><img src="https://i.imgur.com/O5mmQpA.png"
    alt="startup.s">
</figure>
</p>
<h3 id="inline-assmebly-example-1">
  Inline Assmebly Example 1
  <a class="heading-link" href="#inline-assmebly-example-1">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span><span style="color:#ff7b72">__inline</span> <span style="color:#ff7b72">int</span> <span style="color:#d2a8ff;font-weight:bold">myadd</span>(<span style="color:#ff7b72">int</span> x, <span style="color:#ff7b72">int</span> y)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">int</span> result;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">__asm</span>(ADD result, x, y)     <span style="color:#8b949e;font-style:italic">// ADD is an ARM instruction
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">return</span> result;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">int</span> <span style="color:#d2a8ff;font-weight:bold">main</span>(<span style="color:#ff7b72">void</span>)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">int</span> add2numbers, n1 <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">3</span>, n2 <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">5</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    add3numbers <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#d2a8ff;font-weight:bold">myadd</span>(n1, n2);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>result, x and y are normal C variables</li>
<li>However, inline assembly treats them like normal registers. As such, we can expect:</li>
<li>
<ul>
<li><code>ADD result, x, y</code> to actually mean <code>result = x + y</code> just like how we do in ASM</li>
</ul>
</li>
</ul>
<hr>
<h1 id="embedded-assembly">
  Embedded Assembly
  <a class="heading-link" href="#embedded-assembly">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h1>
<p>Think of inline ASM but bigger and fuller. Embedded assembly is all about writing a full assembly function inside a C file.</p>
<h2 id="example-1">
  Example 1
  <a class="heading-link" href="#example-1">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span><span style="color:#ff7b72">__asm</span> <span style="color:#ff7b72">return</span><span style="color:#ff7b72;font-weight:bold">-</span>type function<span style="color:#ff7b72;font-weight:bold">-</span><span style="color:#d2a8ff;font-weight:bold">name</span> (parameters list)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    instructions
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Above is a template of the format used to write an embedded ASM code in C. Below is the implementation:</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span><span style="color:#ff7b72">__asm</span> <span style="color:#ff7b72">void</span> <span style="color:#d2a8ff;font-weight:bold">myFunction</span>(<span style="color:#ff7b72">int</span> x, <span style="color:#ff7b72">int</span> y)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>As usual, we need to mention the <code>__asm</code> part in front to indiciate that this is in fact an ASM code</li>
<li><code>void</code> is the return type of this particular function. This means nothing, meaning it returns nothing. If the return type is <code>int</code> then you need to return an integer. And so on with <code>String</code> and <code>boolean</code> and etc.</li>
<li><code>myFunction</code> is just the name of your ASM function. Name it however you want</li>
<li>Inside the brackets are your parameters. In this example, we initialised two integer parameters called x and y.</li>
</ul>
<h2 id="example-2">
  Example 2
  <a class="heading-link" href="#example-2">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span><span style="color:#8b949e;font-weight:bold;font-style:italic">#include</span> <span style="color:#8b949e;font-weight:bold;font-style:italic">&lt;stdio.h&gt;</span><span style="color:#8b949e;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-weight:bold;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">extern</span> <span style="color:#ff7b72">void</span> <span style="color:#d2a8ff;font-weight:bold">init_serial</span>(<span style="color:#ff7b72">void</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">__asm</span> <span style="color:#ff7b72">void</span> <span style="color:#d2a8ff;font-weight:bold">my_strcopy</span> (<span style="color:#ff7b72">const</span> <span style="color:#ff7b72">char</span> <span style="color:#ff7b72;font-weight:bold">*</span>src, <span style="color:#ff7b72">char</span> <span style="color:#ff7b72;font-weight:bold">*</span>dst)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    loop
</span></span><span style="display:flex;"><span>        LDRB    r2, [r0], <span style="color:#f85149">#</span><span style="color:#a5d6ff">1</span>
</span></span><span style="display:flex;"><span>        STRB    r2, [r1], <span style="color:#f85149">#</span><span style="color:#a5d6ff">1</span>
</span></span><span style="display:flex;"><span>        CMP     r2, <span style="color:#f85149">#</span><span style="color:#a5d6ff">0</span>
</span></span><span style="display:flex;"><span>        BNE     loop
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        BX lr
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">int</span> <span style="color:#d2a8ff;font-weight:bold">main</span>(<span style="color:#ff7b72">void</span>)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">const</span> <span style="color:#ff7b72">char</span> <span style="color:#ff7b72;font-weight:bold">*</span>a <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#34;hello world&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">char</span> b[<span style="color:#a5d6ff">12</span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#d2a8ff;font-weight:bold">init_serial</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#d2a8ff;font-weight:bold">my_strcopy</span>(a, b);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#d2a8ff;font-weight:bold">printf</span>(<span style="color:#a5d6ff">&#34;Original string: &#39;%s&#39;</span><span style="color:#79c0ff">\n</span><span style="color:#a5d6ff">&#34;</span>, a);
</span></span><span style="display:flex;"><span>    <span style="color:#d2a8ff;font-weight:bold">printf</span>(<span style="color:#a5d6ff">&#34;Copied string: &#39;%s&#39;</span><span style="color:#79c0ff">\n</span><span style="color:#a5d6ff">&#34;</span>, b);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">return</span> <span style="color:#a5d6ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Let&rsquo;s go through line-by-line for the important parts:</p>
<ul>
<li>
<p><code>__asm void my_strcopy(const char *src, char *dst)</code></p>
</li>
<li>
<ul>
<li>We are defining an embedded ASM function called <code>my_strcopy</code></li>
</ul>
</li>
<li>
<ul>
<li>It has 2 parameters:</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li><code>src</code> - Pointer to source string</li>
</ul>
</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li><code>dst</code> - Pointer to destination buffer</li>
</ul>
</li>
</ul>
</li>
<li>
<ul>
<li>Remember about AAPCS from before:</li>
</ul>
</li>
<li>
<ul>
<li>In Laymen&rsquo;s term, because our first argument in the bracket is <code>src</code>, it goes to register r0 first. Then, we do <code>dst</code> which goes into register r1. All of this is automated because of AAPCS.</li>
</ul>
</li>
<li>
<ul>
<li>We will see it in the <code>int main(void)</code> body later</li>
</ul>
</li>
<li>
<p>Time for the loop body</p>
</li>
<li>
<p><code>loop</code> - Start of the loop body</p>
</li>
<li>
<p><code>LDRB r2, [r0], #1</code></p>
</li>
<li>
<ul>
<li><code>LDRB</code> = Load Register Byte, which means 1 byte</li>
</ul>
</li>
<li>
<ul>
<li>As such, this line loads 1 byte from the address stored at <code>r0</code> and store it into r2, after loading, increment <code>r0</code> by 1 (post-indexing)</li>
</ul>
</li>
<li>
<ul>
<li>If we look at the string <code>r0</code> is pointing at, it&rsquo;s this &ldquo;hello world&rdquo;. As such, if <code>r0</code> is initially point at &ldquo;h&rdquo;, it loads that &ldquo;h&rdquo; into r2, then post-index increment by 1, now <code>r0</code> points at &ldquo;e&rdquo;</li>
</ul>
</li>
<li>
<p><code>STRB r2, [r1], #1</code></p>
</li>
<li>
<ul>
<li>Opposite of <code>LDRB</code>, we store 1 byte from register into the memory</li>
</ul>
</li>
<li>
<ul>
<li>As such, we store the content of <code>r2</code> into the address pointed by <code>r1</code>. Then after storing, post-index increment by 1</li>
</ul>
</li>
<li>
<ul>
<li>So taking the &ldquo;hello world&rdquo; example from just now, remember how r2 currently has the &ldquo;h&rdquo; string, we essentially are taking that &ldquo;h&rdquo; and copying it into the address pointed at by r1. Now the name of the ASM function makes a lot of sense right?</li>
</ul>
</li>
<li>
<p><code>CMP r2, #0</code></p>
</li>
<li>
<ul>
<li>We compare if r2 is equal to zero. Why?</li>
</ul>
</li>
<li>
<ul>
<li>Think of it as the end of the String of &ldquo;hello world&rdquo;</li>
</ul>
</li>
<li>
<p><code>BNE loop</code></p>
</li>
<li>
<ul>
<li>If <code>r2 != 0</code>, continue copying the string</li>
</ul>
</li>
<li>
<ul>
<li>If <code>r2 == 0</code>, exit loop. String ended</li>
</ul>
</li>
<li>
<p><code>BX lr</code></p>
</li>
<li>
<ul>
<li>Similar to coding in ASM, we use <code>BX lr</code> to return to the <code>main</code> function after finishing your business here. We will see how lr is used initially as the return address later</li>
</ul>
</li>
<li>
<p>This part is the C code. Now, I don&rsquo;t actually think this course focuses on C programming. As such, don&rsquo;t stress too much on understanding the syntax of C.</p>
</li>
<li>
<p><code>int main(void)</code></p>
</li>
<li>
<ul>
<li>This is just main C function</li>
</ul>
</li>
<li>
<p><code>const char *a = &quot;hello world&quot;;</code></p>
</li>
<li>
<p><code>char b[12];</code></p>
</li>
<li>
<ul>
<li>Remember when we discussed about AAPCS allocating <code>r0</code> and <code>r1</code> to their corresponding shit, this is that shit I was mentioning.</li>
</ul>
</li>
<li>
<ul>
<li><code>r0</code> which points to <code>a</code> which points to a literal string:  &ldquo;h e l l o   w o r l d \0&rdquo;</li>
</ul>
</li>
<li>
<ul>
<li><code>r1</code> which points to <code>b</code> which is just an empty buffer</li>
</ul>
</li>
<li>
<p><code>my_strcopy(a, b)</code></p>
</li>
<li>
<ul>
<li>AAPCS will do:</li>
</ul>
</li>
<li>
<ul>
<li><code>r0 = a</code></li>
</ul>
</li>
<li>
<ul>
<li><code>r1 = b</code></li>
</ul>
</li>
<li>
<ul>
<li><code>BL my_strcopy</code></li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>Remember <code>Branch Link</code>, BL from the Subroutine blog?</li>
</ul>
</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>Just remember the important thing from BL, it will saves a returning address in the Link Register (lr). That&rsquo;s why, at the end of the ASM code, we have to do <code>BX lr</code> to return to the main C program</li>
</ul>
</li>
</ul>
</li>
<li>
<p>After running the ASM code, <code>b</code> should contain the copied string from <code>a</code></p>
</li>
<li>
<p><code>printf(&quot;Original string: '%s'\n&quot;, a);</code></p>
</li>
<li>
<p><code>printf(&quot;Copied string: '%s'\n&quot;, b);</code></p>
</li>
<li>
<ul>
<li>Thus, the output from these two lines should be:</li>
</ul>
</li>
<li>
<ul>
<li>Original string: &lsquo;hello world&rsquo;</li>
</ul>
</li>
<li>
<ul>
<li>Copied string: &lsquo;hello world&rsquo;</li>
</ul>
</li>
</ul>

  </article>
</section>

  

    </div>

    <footer class="footer">
  <section class="container">
    ©
    
    2025
     Carl Ho 
    ·
    
    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/" target="_blank" rel="noopener">Coder</a>.
    
  </section>
</footer>

  </main>

  

  
  
  <script src="/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js" integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script>
  

  

  


  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>
</html>
